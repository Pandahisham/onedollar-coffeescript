(function(){"use strict";window.OneDollar=function(){function t(t,e,n,i){this.fragmentation=null!=t?t:64,this.size=null!=e?e:250,this.angle=null!=n?n:45,this.step=null!=i?i:2,this.PI=Math.PI,this.PHI=.5*(-1+Math.sqrt(5)),this.HALFDIAGONAL=.5*Math.sqrt(this.size*this.size+this.size*this.size),this.templates={}}var e,n;return n=function(){function t(t,e){this.x=null!=t?t:0,this.y=null!=e?e:0}return t.prototype.dist=function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},t.prototype.add=function(e){return e instanceof t?(this.x+=e.x,this.y+=e.y):(this.x+=e,this.y+=e),this},t.prototype.div=function(e){return e instanceof t?(this.x/=e.x,this.y/=e.y):(this.x/=e,this.y/=e),this},t.prototype.mult=function(e){return e instanceof t?(this.x*=e.x,this.y*=e.y):(this.x*=e,this.y*=e),this},t}(),e=function(){function t(t,e){this.name=null!=t?t:"",this.score=null!=e?e:0}return t}(),t.prototype.learn=function(t,e){return e.length>0&&(this.templates[t]=this._transform(e)),this},t.prototype.check=function(t){var e,n,i,r,s,_,h;if(!(t.length>0))return!1;t=this._transform(t),e=+1/0,s=null,h=this.templates;for(n in h)_=h[n],r=this.__find_best_template(t,_),e>r&&(e=r,s=n);return null!==s?(i=Math.floor(100*(1-e/this.HALFDIAGONAL)),console.log("template ",s," score",i),t):!1},t.prototype._transform=function(t){return t=this.__convert(t),t=this.__resample(t),t=this.__rotate_to_zero(t),t=this.__scale_to_square(t),t=this.__translate_to_origin(t)},t.prototype.__convert=function(t){var e,i,r,s;for(i=[],r=0,s=t.length;s>r;r++)e=t[r],i.push(new n(e[0],e[1]));return i},t.prototype.__resample=function(t){var e,i,r,s,_,h,o,a,l,u,f;for(h=this.___get_length(t)/(this.fragmentation-1),e=0,_=[];0!==t.length;)if(s=t.pop(),0===_.length)_.push(s);else{if(0===t.length){_.push(s);break}if(r=t[t.length-1],o=s.dist(r),e+o>=h){if(a=new n(s.x+(h-e)/o*(r.x-s.x),s.y+(h-e)/o*(r.y-s.y)),_.push(a),t.push(a),e=0,_.length===this.fragmentation-1){_.push(t[t.length-1]);break}}else e+=o}if(_.length!==this.fragmentation)for(r=_[_.length-1],i=l=u=_.length,f=this.fragmentation;f>=u?f>l:l>f;i=f>=u?++l:--l)_.push(r);return _},t.prototype.__rotate_to_zero=function(t){var e,n;return e=this.___get_centroid(t),n=Math.atan2(e.y-t[0].y,e.x-t[0].x),this.___rotate(t,-n,e)},t.prototype.__scale_to_square=function(t){var e,i,r,s,_,h,o;for(e=i=-1/0,r=s=+1/0,h=0,o=t.length;o>h;h++)_=t[h],r=Math.min(_.x,r),e=Math.max(_.x,e),s=Math.min(_.y,s),i=Math.max(_.y,i);return this.___scale(t,new n(this.size/(e-r),this.size/(i-s)))},t.prototype.__translate_to_origin=function(t){var e;return e=this.___get_centroid(t),this.___translate(t,e.mult(-1))},t.prototype.__find_best_template=function(t,e){var n,i,r,s,_,h,o;if(n=this.___radians(-this.angle),i=this.___radians(this.angle),o=this.___radians(this.step),r=(1-this.PHI)*i+this.PHI*n,s=(1-this.PHI)*n+this.PHI*i,_=this.___get_difference_at_angle(t,e,r),h=this.___get_difference_at_angle(t,e,s),_!==+1/0&&h!==+1/0){for(;Math.abs(i-n)>o;)h>_?(i=s,s=r,h=_,r=this.PHI*n+(1-this.PHI)*i,_=this.___get_difference_at_angle(t,e,r)):(n=r,r=s,_=h,s=this.PHI*i+(1-this.PHI)*n,h=this.___get_difference_at_angle(t,e,s));return Math.min(_,h)}return+1/0},t.prototype.___get_centroid=function(t){var e,i,r,s;for(e=new n,r=0,s=t.length;s>r;r++)i=t[r],e.add(i);return e.div(t.length),e},t.prototype.___get_length=function(t){var e,n,i,r,s;for(e=0,i=null,r=0,s=t.length;s>r;r++)n=t[r],null!==i&&(e+=n.dist(i)),i=n;return e},t.prototype.___get_difference_at_angle=function(t,e,n){var i;return i=this.___get_centroid(t),t=this.___rotate(t,n,i),this.___get_difference(t,e)},t.prototype.___get_difference=function(t,e){var n,i,r,s,_;for(n=0,i=s=0,_=t.length;_>s;i=++s)r=t[i],n+=r.dist(e[i]);return n/t.length},t.prototype.___translate=function(t,e){var n,i,r;for(i=0,r=t.length;r>i;i++)n=t[i],n.add(e);return t},t.prototype.___scale=function(t,e){var n,i,r;for(i=0,r=t.length;r>i;i++)n=t[i],n.mult(e);return t},t.prototype.___rotate=function(t,e,i){var r,s,_,h,o,a,l,u;for(h=Math.sin(e),r=Math.cos(e),s=l=0,u=t.length;u>l;s=++l)_=t[s],o=(_.x-i.x)*r-(_.y-i.y)*h+i.x,a=(_.x-i.x)*h+(_.y-i.y)*r+i.y,t[s]=new n(o,a);return t},t.prototype.___radians=function(t){return t*Math.PI/180},t}()}).call(this);