(function(){window.OneDollar=function(){function f(a,b,c,d,e){null==a&&(a=80);null==b&&(b=64);null==c&&(c=250);null==d&&(d=45);null==e&&(e=2);this.config={score:a};this.MATH={PHI:0.5*(-1+Math.sqrt(5)),HALFDIAGONAL:0.5*Math.sqrt(c*c+c*c)};this.ALGO={parts:b,size:c,angle:d,step:e};this.temps={};this.binds={}}var l;l=function(){function a(a,c){this.x=null!=a?a:0;this.y=null!=c?c:0}a.prototype.dist=function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))};a.prototype.add=function(b){b instanceof
a?(this.x+=b.x,this.y+=b.y):(this.x+=b,this.y+=b);return this};a.prototype.div=function(b){b instanceof a?(this.x/=b.x,this.y/=b.y):(this.x/=b,this.y/=b);return this};a.prototype.mult=function(b){b instanceof a?(this.x*=b.x,this.y*=b.y):(this.x*=b,this.y*=b);return this};return a}();f.prototype.add=function(a,b){0<b.length&&(this.temps[a]=this._transform(b));return this};f.prototype.remove=function(a){void 0!==this.temps[a]&&delete this.temps[a];return this};f.prototype.on=function(a,b){this.binds[a]=
b;return this};f.prototype.off=function(a){void 0!==this.binds[a]&&delete this.binds[a];return this};f.prototype.check=function(a){var b,c,d,e,g;if(0<a.length)a=this._transform(a);else return!1;b=Infinity;e=null;g=this.temps;for(c in g)d=g[c],void 0!==this.binds[c]&&(d=this.__find_best_template(a,d),d<b&&(b=d,e=c));return null!==e&&(a={name:e,score:(100*(1-b/this.MATH.HALFDIAGONAL)).toFixed(2)},a.score>=this.config.score)?(this.binds[e].apply(this,[a]),a):!1};f.prototype._transform=function(a){a=
this.__convert(a);a=this.__resample(a);a=this.__rotate_to_zero(a);a=this.__scale_to_square(a);return a=this.__translate_to_origin(a)};f.prototype.__convert=function(a){var b,c,d,e;c=[];d=0;for(e=a.length;d<e;d++)b=a[d],c.push(new l(b[0],b[1]));return c};f.prototype.__resample=function(a){var b,c,d,e,g,k;g=this.___get_length(a)/(this.ALGO.parts-1);b=0;for(e=[];0!==a.length;)if(d=a.pop(),0===e.length)e.push(d);else{if(0===a.length){e.push(d);break}c=a[a.length-1];k=d.dist(c);if(b+k>=g){if(c=new l(d.x+
(g-b)/k*(c.x-d.x),d.y+(g-b)/k*(c.y-d.y)),e.push(c),a.push(c),b=0,e.length===this.ALGO.parts-1){e.push(a[a.length-1]);break}}else b+=k}if(e.length!==this.ALGO.parts){c=e[e.length-1];a=g=e.length;for(b=this.ALGO.parts;g<=b?a<b:a>b;g<=b?++a:--a)e.push(c)}return e};f.prototype.__rotate_to_zero=function(a){var b,c;b=this.___get_centroid(a);c=Math.atan2(b.y-a[0].y,b.x-a[0].x);return this.___rotate(a,-c,b)};f.prototype.__scale_to_square=function(a){var b,c,d,e,g,k,f;b=c=-Infinity;d=e=Infinity;k=0;for(f=
a.length;k<f;k++)g=a[k],d=Math.min(g.x,d),b=Math.max(g.x,b),e=Math.min(g.y,e),c=Math.max(g.y,c);return this.___scale(a,new l(this.ALGO.size/(b-d),this.ALGO.size/(c-e)))};f.prototype.__translate_to_origin=function(a){var b;b=this.___get_centroid(a);return this.___translate(a,b.mult(-1))};f.prototype.__find_best_template=function(a,b){var c,d,e,g,f,h,l;c=this.___radians(-this.ALGO.angle);d=this.___radians(this.ALGO.angle);l=this.___radians(this.ALGO.step);e=(1-this.MATH.PHI)*d+this.MATH.PHI*c;g=(1-
this.MATH.PHI)*c+this.MATH.PHI*d;f=this.___get_difference_at_angle(a,b,e);h=this.___get_difference_at_angle(a,b,g);if(Infinity!==f&&Infinity!==h){for(;Math.abs(d-c)>l;)f<h?(d=g,g=e,h=f,e=this.MATH.PHI*c+(1-this.MATH.PHI)*d,f=this.___get_difference_at_angle(a,b,e)):(c=e,e=g,f=h,g=this.MATH.PHI*d+(1-this.MATH.PHI)*c,h=this.___get_difference_at_angle(a,b,g));return Math.min(f,h)}return Infinity};f.prototype.___get_centroid=function(a){var b,c,d,e;b=new l;d=0;for(e=a.length;d<e;d++)c=a[d],b.add(c);b.div(a.length);
return b};f.prototype.___get_length=function(a){var b,c,d,e,g;b=0;d=null;e=0;for(g=a.length;e<g;e++)c=a[e],null!==d&&(b+=c.dist(d)),d=c;return b};f.prototype.___get_difference_at_angle=function(a,b,c){var d;d=this.___get_centroid(a);a=this.___rotate(a,c,d);return this.___get_difference(a,b)};f.prototype.___get_difference=function(a,b){var c,d,e,g,f;d=g=c=0;for(f=a.length;g<f;d=++g)e=a[d],c+=e.dist(b[d]);return c/a.length};f.prototype.___translate=function(a,b){var c,d,e;d=0;for(e=a.length;d<e;d++)c=
a[d],c.add(b);return a};f.prototype.___scale=function(a,b){var c,d,e;d=0;for(e=a.length;d<e;d++)c=a[d],c.mult(b);return a};f.prototype.___rotate=function(a,b,c){var d,e,g,f,h,m;g=Math.sin(b);b=Math.cos(b);d=h=0;for(m=a.length;h<m;d=++h)e=a[d],f=(e.x-c.x)*b-(e.y-c.y)*g+c.x,e=(e.x-c.x)*g+(e.y-c.y)*b+c.y,a[d]=new l(f,e);return a};f.prototype.___radians=function(a){return a*Math.PI/180};return f}()}).call(this);
