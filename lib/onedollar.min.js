(function(){window.OneDollar=function(){function t(t,n,e,o){this.fragmentation=null!=t?t:64,this.size=null!=n?n:250,this.angle=null!=e?e:45,this.step=null!=o?o:3,this.PI=Math.PI,this.HALFDIAGONAL=.5*Math.sqrt(this.size*this.size+this.size*this.size),this.templates={}}var n;return n=function(){function t(t,n){this.x=null!=t?t:0,this.y=null!=n?n:0}return t.prototype.dist=function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.div=function(t){return this.x/=t,this.y/=t,this},t}(),t.prototype.learn=function(t,n){return n.length>0?(n=this._transform(n),this.templates[t]=n):void 0},t.prototype.check=function(t){return t.length>0?t=this._transform(t):void 0},t.prototype._transform=function(t){return t=this.__convert(t),t=this.__resample(t),t=this.__rotate(t),t=this.__scale(t),t=this.__translate(t)},t.prototype.__convert=function(t){var e,o,r,i;for(o=[],r=0,i=t.length;i>r;r++)e=t[r],o.push(new n(e[0],e[1]));return o},t.prototype.__resample=function(t){var e,o,r,i,s,h,l,a,u,_,p;for(console.log("__resample"),h=this.___length(t)/(this.fragmentation-1),e=0,s=[];0!==t.length;)if(i=t.pop(),0===s.length)s.push(i);else{if(0===t.length){s.push(i);break}if(r=t[t.length-1],l=i.dist(r),e+l>=h){if(a=new n(i.x+(h-e)/l*(r.x-i.x),i.y+(h-e)/l*(r.y-i.y)),s.push(a),t.push(a),e=0,s.length===this.fragmentation-1){s.push(t[t.length-1]);break}}else e+=l}if(s.length!==this.fragmentation)for(r=s[s.length-1],o=u=_=s.length,p=this.fragmentation;p>=_?p>u:u>p;o=p>=_?++u:--u)s.push(r);return s},t.prototype.__rotate=function(t){var e,o,r,i,s,h,l,a,u,_;for(console.log("__rotate"),e=this.___centroid(t),h=Math.atan2(e.y-t[0].y,e.x-t[0].x),s=Math.sin(h),o=Math.cos(h),r=u=0,_=t.length;_>u;r=++u)i=t[r],l=(i.x-e.x)*o-(i.y-e.y)*s+e.x,a=(i.x-e.x)*s+(i.y-e.y)*o+e.y,t[r]=new n(l,a);return t},t.prototype.__scale=function(t){var e,o,r,i,s,h,l,a,u,_,p,f,c,y;for(console.log("__scale"),r=i=-1/0,s=h=+1/0,p=0,c=t.length;c>p;p++)l=t[p],s=Math.min(l.x,s),r=Math.max(l.x,r),h=Math.min(l.y,h),i=Math.max(l.y,i);for(a=r-s,e=i-h,o=f=0,y=t.length;y>f;o=++f)l=t[o],u=l.x*this.size/a,_=l.y*this.size/e,t[o]=new n(u,_);return t},t.prototype.__translate=function(t){var n,e,o,r;for(console.log("__translate"),n=this.___centroid(t),o=0,r=t.length;r>o;o++)e=t[o],e.x-=n.x,e.y-=n.y;return t},t.prototype.___centroid=function(t){var e,o,r,i;for(e=new n,r=0,i=t.length;i>r;r++)o=t[r],e.add(o);return e.div(t.length),e},t.prototype.___length=function(t){var n,e,o,r,i;for(n=0,o=null,r=0,i=t.length;i>r;r++)e=t[r],console.log(e.x,e.y),null!==o&&(n+=e.dist(o)),o=e;return console.log("=",n),n},t}()}).call(this);