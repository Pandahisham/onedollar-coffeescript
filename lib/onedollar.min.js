(function(){"use strict";window.OneDollar=function(){function e(e,t,n,r,i){e==null&&(e=80),t==null&&(t=64),n==null&&(n=250),r==null&&(r=45),i==null&&(i=2),this.VERSION="1.0.1",this.config={score:e},this.MATH={PHI:.5*(-1+Math.sqrt(5)),HALFDIAGONAL:.5*Math.sqrt(n*n+n*n)},this.ALGO={parts:t,size:n,angle:r,step:i},this.temps={},this.binds={}}var t;return t=function(){function e(e,t){this.x=e!=null?e:0,this.y=t!=null?t:0}return e.prototype.dist=function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},e.prototype.add=function(t){return t instanceof e?(this.x+=t.x,this.y+=t.y):(this.x+=t,this.y+=t),this},e.prototype.div=function(t){return t instanceof e?(this.x/=t.x,this.y/=t.y):(this.x/=t,this.y/=t),this},e.prototype.mult=function(t){return t instanceof e?(this.x*=t.x,this.y*=t.y):(this.x*=t,this.y*=t),this},e}(),e.prototype.add=function(e,t){return t.length>0&&(this.temps[e]=this._transform(t)),this},e.prototype.remove=function(e){return this.temps[e]!==void 0&&delete this.temps[e],this},e.prototype.on=function(e,t){return this.binds[e]=t,this},e.prototype.off=function(e){return this.binds[e]!==void 0&&delete this.binds[e],this},e.prototype.check=function(e){var n,r,i,s,o,u,a,f,l;o=e;if(e.length>0){e=this._transform(e),r=+Infinity,a=null,s=[],l=this.temps;for(i in l)f=l[i],this.binds[i]!==void 0&&(u=this.__find_best_template(e,f),u<r&&(r=u,a=i),s.push({name:i,score:parseFloat(((1-u/this.MATH.HALFDIAGONAL)*100).toFixed(2))}));if(a!==null){s.sort(function(e,t){return e.score<t.score?1:-1});if(s[0].score>=this.config.score)return n={name:s[0].name,score:s[0].score,path:{start:new t(o[0][0],o[0][1]),end:new t(o[o.length-1][0],o[o.length-1][1]),centroid:this.___get_centroid(this.__convert(o))},ranking:s},this.binds[a].apply(this,[n]),n}return!1}return!1},e.prototype._transform=function(e){return e=this.__convert(e),e=this.__resample(e),e=this.__rotate_to_zero(e),e=this.__scale_to_square(e),e=this.__translate_to_origin(e),e},e.prototype.__convert=function(e){var n,r,i,s;r=[];for(i=0,s=e.length;i<s;i++)n=e[i],r.push(new t(n[0],n[1]));return r},e.prototype.__resample=function(e){var n,r,i,s,o,u,a,f,l,c,h;u=this.___get_length(e)/(this.ALGO.parts-1),n=0,o=[];while(e.length!==0){s=e.pop();if(o.length===0)o.push(s);else{if(e.length===0){o.push(s);break}i=e[e.length-1],a=s.dist(i);if(n+a>=u){f=new t(s.x+(u-n)/a*(i.x-s.x),s.y+(u-n)/a*(i.y-s.y)),o.push(f),e.push(f),n=0;if(o.length===this.ALGO.parts-1){o.push(e[e.length-1]);break}}else n+=a}}if(o.length!==this.ALGO.parts){i=o[o.length-1];for(r=l=c=o.length,h=this.ALGO.parts;c<=h?l<h:l>h;r=c<=h?++l:--l)o.push(i)}return o},e.prototype.__rotate_to_zero=function(e){var t,n;return t=this.___get_centroid(e),n=Math.atan2(t.y-e[0].y,t.x-e[0].x),this.___rotate(e,-n,t)},e.prototype.__scale_to_square=function(e){var n,r,i,s,o,u,a;n=r=-Infinity,i=s=+Infinity;for(u=0,a=e.length;u<a;u++)o=e[u],i=Math.min(o.x,i),n=Math.max(o.x,n),s=Math.min(o.y,s),r=Math.max(o.y,r);return this.___scale(e,new t(this.ALGO.size/(n-i),this.ALGO.size/(r-s)))},e.prototype.__translate_to_origin=function(e){var t;return t=this.___get_centroid(e),this.___translate(e,t.mult(-1))},e.prototype.__find_best_template=function(e,t){var n,r,i,s,o,u,a;n=this.___radians(-this.ALGO.angle),r=this.___radians(this.ALGO.angle),a=this.___radians(this.ALGO.step),i=(1-this.MATH.PHI)*r+this.MATH.PHI*n,s=(1-this.MATH.PHI)*n+this.MATH.PHI*r,o=this.___get_difference_at_angle(e,t,i),u=this.___get_difference_at_angle(e,t,s);if(o!==+Infinity&&u!==+Infinity){while(Math.abs(r-n)>a)o<u?(r=s,s=i,u=o,i=this.MATH.PHI*n+(1-this.MATH.PHI)*r,o=this.___get_difference_at_angle(e,t,i)):(n=i,i=s,o=u,s=this.MATH.PHI*r+(1-this.MATH.PHI)*n,u=this.___get_difference_at_angle(e,t,s));return Math.min(o,u)}return+Infinity},e.prototype.___get_centroid=function(e){var n,r,i,s;n=new t;for(i=0,s=e.length;i<s;i++)r=e[i],n.add(r);return n.div(e.length),n},e.prototype.___get_length=function(e){var t,n,r,i,s;t=0,r=null;for(i=0,s=e.length;i<s;i++)n=e[i],r!==null&&(t+=n.dist(r)),r=n;return t},e.prototype.___get_difference_at_angle=function(e,t,n){var r;return r=this.___get_centroid(e),e=this.___rotate(e,n,r),this.___get_difference(e,t)},e.prototype.___get_difference=function(e,t){var n,r,i,s,o;n=0;for(r=s=0,o=e.length;s<o;r=++s)i=e[r],n+=i.dist(t[r]);return n/e.length},e.prototype.___translate=function(e,t){var n,r,i;for(r=0,i=e.length;r<i;r++)n=e[r],n.add(t);return e},e.prototype.___scale=function(e,t){var n,r,i;for(r=0,i=e.length;r<i;r++)n=e[r],n.mult(t);return e},e.prototype.___rotate=function(e,n,r){var i,s,o,u,a,f,l,c;u=Math.sin(n),i=Math.cos(n);for(s=l=0,c=e.length;l<c;s=++l)o=e[s],a=(o.x-r.x)*i-(o.y-r.y)*u+r.x,f=(o.x-r.x)*u+(o.y-r.y)*i+r.y,e[s]=new t(a,f);return e},e.prototype.___radians=function(e){return e*Math.PI/180},e}()}).call(this);