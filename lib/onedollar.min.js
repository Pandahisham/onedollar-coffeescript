/* OneDollar.js ~ 1.1.1 ~ https://github.com/voidplus/onedollar-coffeescript.git */
(function(){var a;a=function(){function a(a,b,c,d,e){null==a&&(a=80),null==b&&(b=64),null==c&&(c=250),null==d&&(d=45),null==e&&(e=2),this.CFG={score:a},this.MATH={PHI:.5*(-1+Math.sqrt(5)),HALFDIAGONAL:.5*Math.sqrt(c*c+c*c)},this.ALGO={parts:b,size:c,angle:d,step:e},this.temps={},this.binds={},this.cands=[]}var b;return b=function(){function a(a,b){this.x=null!=a?a:0,this.y=null!=b?b:0}return a.prototype.dist=function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))},a.prototype.add=function(b){return b instanceof a?(this.x+=b.x,this.y+=b.y):(this.x+=b,this.y+=b),this},a.prototype.div=function(b){return b instanceof a?(this.x/=b.x,this.y/=b.y):(this.x/=b,this.y/=b),this},a.prototype.mult=function(b){return b instanceof a?(this.x*=b.x,this.y*=b.y):(this.x*=b,this.y*=b),this},a}(),a.prototype.add=function(a,b){return b.length>0&&(this.temps[a]=this._transform(b)),this},a.prototype.remove=function(a){return void 0!==this.temps[a]&&delete this.temps[a],this},a.prototype.on=function(a,b){var c,d,e;for(c=a.split(" "),d=0,e=c.length;e>d;d++)a=c[d],void 0!==this.temps[a]&&(this.binds[a]=b);return this},a.prototype.off=function(a){return void 0!==this.binds[a]&&delete this.binds[a],this},a.prototype.check=function(a){var c,d,e,f,g,h,i,j,k;if(g=a,!(a.length>0))return!1;a=this._transform(a),d=+1/0,i=null,f=[],k=this.temps;for(e in k)j=k[e],void 0!==this.binds[e]&&(h=this.__findBestTemplate(a,j),d>h&&(d=h,i=e),f.push({name:e,score:parseFloat((100*(1-h/this.MATH.HALFDIAGONAL)).toFixed(2))}));return null!==i&&(f.sort(function(a,b){return a.score<b.score?1:-1}),f[0].score>=this.CFG.score)?(c={name:f[0].name,score:f[0].score,path:{start:new b(g[0][0],g[0][1]),end:new b(g[g.length-1][0],g[g.length-1][1]),centroid:this.___centroid(this.__convert(g))},ranking:f},this.binds[i].apply(this,[c]),c):!1},a.prototype.start=function(a,b){return this.cands[a]=[],this.cands[a].push(b)},a.prototype.update=function(a,b){return this.cands[a].push(b)},a.prototype.end=function(a,b){return this.cands[a].push(b),this.check(this.cands[a]),delete this.cands[a]},a.prototype._transform=function(a){return a=this.__convert(a),a=this.__resample(a),a=this.__r2Zero(a),a=this.__s2Square(a),a=this.__t2Origin(a)},a.prototype.__convert=function(a){var c,d,e,f;for(d=[],e=0,f=a.length;f>e;e++)c=a[e],d.push(new b(c[0],c[1]));return d},a.prototype.__resample=function(a){var c,d,e,f,g,h,i,j,k,l,m;for(h=this.___length(a)/(this.ALGO.parts-1),c=0,g=[];0!==a.length;)if(f=a.pop(),0===g.length)g.push(f);else{if(0===a.length){g.push(f);break}if(e=a[a.length-1],i=f.dist(e),c+i>=h){if(j=new b(f.x+(h-c)/i*(e.x-f.x),f.y+(h-c)/i*(e.y-f.y)),g.push(j),a.push(j),c=0,g.length===this.ALGO.parts-1){g.push(a[a.length-1]);break}}else c+=i}if(g.length!==this.ALGO.parts)for(e=g[g.length-1],d=k=l=g.length,m=this.ALGO.parts;m>=l?m>k:k>m;d=m>=l?++k:--k)g.push(e);return g},a.prototype.__r2Zero=function(a){var b,c;return b=this.___centroid(a),c=Math.atan2(b.y-a[0].y,b.x-a[0].x),this.___r(a,-c,b)},a.prototype.__s2Square=function(a){var c,d,e,f,g,h,i;for(c=d=-1/0,e=f=+1/0,h=0,i=a.length;i>h;h++)g=a[h],e=Math.min(g.x,e),c=Math.max(g.x,c),f=Math.min(g.y,f),d=Math.max(g.y,d);return this.___s(a,new b(this.ALGO.size/(c-e),this.ALGO.size/(d-f)))},a.prototype.__t2Origin=function(a){var b;return b=this.___centroid(a),this.___t(a,b.mult(-1))},a.prototype.__findBestTemplate=function(a,b){var c,d,e,f,g,h,i;if(c=this.___rd(-this.ALGO.angle),d=this.___rd(this.ALGO.angle),i=this.___rd(this.ALGO.step),e=(1-this.MATH.PHI)*d+this.MATH.PHI*c,f=(1-this.MATH.PHI)*c+this.MATH.PHI*d,g=this.___getDifferenceAtAngle(a,b,e),h=this.___getDifferenceAtAngle(a,b,f),g!==+1/0&&h!==+1/0){for(;Math.abs(d-c)>i;)h>g?(d=f,f=e,h=g,e=this.MATH.PHI*c+(1-this.MATH.PHI)*d,g=this.___getDifferenceAtAngle(a,b,e)):(c=e,e=f,g=h,f=this.MATH.PHI*d+(1-this.MATH.PHI)*c,h=this.___getDifferenceAtAngle(a,b,f));return Math.min(g,h)}return+1/0},a.prototype.___centroid=function(a){var c,d,e,f;for(c=new b,e=0,f=a.length;f>e;e++)d=a[e],c.add(d);return c.div(a.length),c},a.prototype.___length=function(a){var b,c,d,e,f;for(b=0,d=null,e=0,f=a.length;f>e;e++)c=a[e],null!==d&&(b+=c.dist(d)),d=c;return b},a.prototype.___getDifferenceAtAngle=function(a,b,c){var d;return d=this.___centroid(a),a=this.___r(a,c,d),this.___getDifference(a,b)},a.prototype.___getDifference=function(a,b){var c,d,e,f,g;for(c=0,d=f=0,g=a.length;g>f;d=++f)e=a[d],c+=e.dist(b[d]);return c/a.length},a.prototype.___t=function(a,b){var c,d,e;for(d=0,e=a.length;e>d;d++)c=a[d],c.add(b);return a},a.prototype.___s=function(a,b){var c,d,e;for(d=0,e=a.length;e>d;d++)c=a[d],c.mult(b);return a},a.prototype.___r=function(a,c,d){var e,f,g,h,i,j,k,l;for(h=Math.sin(c),e=Math.cos(c),f=k=0,l=a.length;l>k;f=++k)g=a[f],i=(g.x-d.x)*e-(g.y-d.y)*h+d.x,j=(g.x-d.x)*h+(g.y-d.y)*e+d.y,a[f]=new b(i,j);return a},a.prototype.___rd=function(a){return a*Math.PI/180},a}(),window.OneDollar=a}).call(this);