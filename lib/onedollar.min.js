(function(){window.OneDollar=function(){function f(a,b,d,c){null==a&&(a=64);null==b&&(b=250);null==d&&(d=45);null==c&&(c=2);this.MATH={PHI:0.5*(-1+Math.sqrt(5)),HALFDIAGONAL:0.5*Math.sqrt(b*b+b*b)};this.ALGO={parts:a,size:b,angle:d,step:c};this.temps={};this.binds={}}var l;l=function(){function a(a,d){this.x=null!=a?a:0;this.y=null!=d?d:0}a.prototype.dist=function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))};a.prototype.add=function(b){b instanceof a?(this.x+=b.x,this.y+=b.y):
(this.x+=b,this.y+=b);return this};a.prototype.div=function(b){b instanceof a?(this.x/=b.x,this.y/=b.y):(this.x/=b,this.y/=b);return this};a.prototype.mult=function(b){b instanceof a?(this.x*=b.x,this.y*=b.y):(this.x*=b,this.y*=b);return this};return a}();f.prototype.add=function(a,b){0<b.length&&(this.temps[a]=this._transform(b));return this};f.prototype.remove=function(a){void 0!==this.temps[a]&&delete this.temps[a];return this};f.prototype.on=function(a,b){this.binds[a]=b;return this};f.prototype.off=
function(a){void 0!==this.binds[a]&&delete this.binds[a];return this};f.prototype.check=function(a){var b,d,c,e,g;if(0<a.length)a=this._transform(a);else return!1;b=Infinity;e=null;g=this.temps;for(d in g)c=g[d],void 0!==this.binds[d]&&(c=this.__find_best_template(a,c),c<b&&(b=c,e=d));return null!==e?(a={name:e,score:(100*(1-b/this.MATH.HALFDIAGONAL)).toFixed(2)},this.binds[e].apply(this,[a]),a):!1};f.prototype._transform=function(a){a=this.__convert(a);a=this.__resample(a);a=this.__rotate_to_zero(a);
a=this.__scale_to_square(a);return a=this.__translate_to_origin(a)};f.prototype.__convert=function(a){var b,d,c,e;d=[];c=0;for(e=a.length;c<e;c++)b=a[c],d.push(new l(b[0],b[1]));return d};f.prototype.__resample=function(a){var b,d,c,e,g,k;g=this.___get_length(a)/(this.ALGO.parts-1);b=0;for(e=[];0!==a.length;)if(c=a.pop(),0===e.length)e.push(c);else{if(0===a.length){e.push(c);break}d=a[a.length-1];k=c.dist(d);if(b+k>=g){if(d=new l(c.x+(g-b)/k*(d.x-c.x),c.y+(g-b)/k*(d.y-c.y)),e.push(d),a.push(d),b=
0,e.length===this.ALGO.parts-1){e.push(a[a.length-1]);break}}else b+=k}if(e.length!==this.ALGO.parts){d=e[e.length-1];a=g=e.length;for(b=this.ALGO.parts;g<=b?a<b:a>b;g<=b?++a:--a)e.push(d)}return e};f.prototype.__rotate_to_zero=function(a){var b,d;b=this.___get_centroid(a);d=Math.atan2(b.y-a[0].y,b.x-a[0].x);return this.___rotate(a,-d,b)};f.prototype.__scale_to_square=function(a){var b,d,c,e,g,k,f;b=d=-Infinity;c=e=Infinity;k=0;for(f=a.length;k<f;k++)g=a[k],c=Math.min(g.x,c),b=Math.max(g.x,b),e=Math.min(g.y,
e),d=Math.max(g.y,d);return this.___scale(a,new l(this.ALGO.size/(b-c),this.ALGO.size/(d-e)))};f.prototype.__translate_to_origin=function(a){var b;b=this.___get_centroid(a);return this.___translate(a,b.mult(-1))};f.prototype.__find_best_template=function(a,b){var d,c,e,g,f,h,l;d=this.___radians(-this.ALGO.angle);c=this.___radians(this.ALGO.angle);l=this.___radians(this.ALGO.step);e=(1-this.MATH.PHI)*c+this.MATH.PHI*d;g=(1-this.MATH.PHI)*d+this.MATH.PHI*c;f=this.___get_difference_at_angle(a,b,e);h=
this.___get_difference_at_angle(a,b,g);if(Infinity!==f&&Infinity!==h){for(;Math.abs(c-d)>l;)f<h?(c=g,g=e,h=f,e=this.MATH.PHI*d+(1-this.MATH.PHI)*c,f=this.___get_difference_at_angle(a,b,e)):(d=e,e=g,f=h,g=this.MATH.PHI*c+(1-this.MATH.PHI)*d,h=this.___get_difference_at_angle(a,b,g));return Math.min(f,h)}return Infinity};f.prototype.___get_centroid=function(a){var b,d,c,e;b=new l;c=0;for(e=a.length;c<e;c++)d=a[c],b.add(d);b.div(a.length);return b};f.prototype.___get_length=function(a){var b,d,c,e,g;
b=0;c=null;e=0;for(g=a.length;e<g;e++)d=a[e],null!==c&&(b+=d.dist(c)),c=d;return b};f.prototype.___get_difference_at_angle=function(a,b,d){var c;c=this.___get_centroid(a);a=this.___rotate(a,d,c);return this.___get_difference(a,b)};f.prototype.___get_difference=function(a,b){var d,c,e,g,f;c=g=d=0;for(f=a.length;g<f;c=++g)e=a[c],d+=e.dist(b[c]);return d/a.length};f.prototype.___translate=function(a,b){var d,c,e;c=0;for(e=a.length;c<e;c++)d=a[c],d.add(b);return a};f.prototype.___scale=function(a,b){var d,
c,e;c=0;for(e=a.length;c<e;c++)d=a[c],d.mult(b);return a};f.prototype.___rotate=function(a,b,d){var c,e,g,f,h,m;g=Math.sin(b);b=Math.cos(b);c=h=0;for(m=a.length;h<m;c=++h)e=a[c],f=(e.x-d.x)*b-(e.y-d.y)*g+d.x,e=(e.x-d.x)*g+(e.y-d.y)*b+d.y,a[c]=new l(f,e);return a};f.prototype.___radians=function(a){return a*Math.PI/180};return f}()}).call(this);
