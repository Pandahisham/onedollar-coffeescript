(function(){window.OneDollar=function(){function f(a,b,c,d,e){null==a&&(a=80);null==b&&(b=64);null==c&&(c=250);null==d&&(d=45);null==e&&(e=2);this.VERSION="1.0.1";this.config={score:a};this.MATH={PHI:0.5*(-1+Math.sqrt(5)),HALFDIAGONAL:0.5*Math.sqrt(c*c+c*c)};this.ALGO={parts:b,size:c,angle:d,step:e};this.temps={};this.binds={}}var k;k=function(){function a(a,c){this.x=null!=a?a:0;this.y=null!=c?c:0}a.prototype.dist=function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))};a.prototype.add=
function(b){b instanceof a?(this.x+=b.x,this.y+=b.y):(this.x+=b,this.y+=b);return this};a.prototype.div=function(b){b instanceof a?(this.x/=b.x,this.y/=b.y):(this.x/=b,this.y/=b);return this};a.prototype.mult=function(b){b instanceof a?(this.x*=b.x,this.y*=b.y):(this.x*=b,this.y*=b);return this};return a}();f.prototype.add=function(a,b){0<b.length&&(this.temps[a]=this._transform(b));return this};f.prototype.remove=function(a){void 0!==this.temps[a]&&delete this.temps[a];return this};f.prototype.on=
function(a,b){this.binds[a]=b;return this};f.prototype.off=function(a){void 0!==this.binds[a]&&delete this.binds[a];return this};f.prototype.check=function(a){var b,c,d,e,g,h,f;e=a;if(0<a.length)a=this._transform(a);else return!1;b=Infinity;h=null;d=[];f=this.temps;for(c in f)g=f[c],void 0!==this.binds[c]&&(g=this.__find_best_template(a,g),g<b&&(b=g,h=c),d.push({name:c,score:parseFloat((100*(1-g/this.MATH.HALFDIAGONAL)).toFixed(2))}));return null!==h&&(d.sort(function(a,b){return a.score<b.score?
1:-1}),d[0].score>=this.config.score)?(a={name:d[0].name,score:d[0].score,path:{start:new k(e[0][0],e[0][1]),end:new k(e[e.length-1][0],e[e.length-1][1]),centroid:this.___get_centroid(this.__convert(e))},ranking:d},this.binds[h].apply(this,[a]),a):!1};f.prototype._transform=function(a){a=this.__convert(a);a=this.__resample(a);a=this.__rotate_to_zero(a);a=this.__scale_to_square(a);return a=this.__translate_to_origin(a)};f.prototype.__convert=function(a){var b,c,d,e;c=[];d=0;for(e=a.length;d<e;d++)b=
a[d],c.push(new k(b[0],b[1]));return c};f.prototype.__resample=function(a){var b,c,d,e,g,h;g=this.___get_length(a)/(this.ALGO.parts-1);b=0;for(e=[];0!==a.length;)if(d=a.pop(),0===e.length)e.push(d);else{if(0===a.length){e.push(d);break}c=a[a.length-1];h=d.dist(c);if(b+h>=g){if(c=new k(d.x+(g-b)/h*(c.x-d.x),d.y+(g-b)/h*(c.y-d.y)),e.push(c),a.push(c),b=0,e.length===this.ALGO.parts-1){e.push(a[a.length-1]);break}}else b+=h}if(e.length!==this.ALGO.parts){c=e[e.length-1];a=g=e.length;for(b=this.ALGO.parts;g<=
b?a<b:a>b;g<=b?++a:--a)e.push(c)}return e};f.prototype.__rotate_to_zero=function(a){var b,c;b=this.___get_centroid(a);c=Math.atan2(b.y-a[0].y,b.x-a[0].x);return this.___rotate(a,-c,b)};f.prototype.__scale_to_square=function(a){var b,c,d,e,g,h,f;b=c=-Infinity;d=e=Infinity;h=0;for(f=a.length;h<f;h++)g=a[h],d=Math.min(g.x,d),b=Math.max(g.x,b),e=Math.min(g.y,e),c=Math.max(g.y,c);return this.___scale(a,new k(this.ALGO.size/(b-d),this.ALGO.size/(c-e)))};f.prototype.__translate_to_origin=function(a){var b;
b=this.___get_centroid(a);return this.___translate(a,b.mult(-1))};f.prototype.__find_best_template=function(a,b){var c,d,e,g,h,f,k;c=this.___radians(-this.ALGO.angle);d=this.___radians(this.ALGO.angle);k=this.___radians(this.ALGO.step);e=(1-this.MATH.PHI)*d+this.MATH.PHI*c;g=(1-this.MATH.PHI)*c+this.MATH.PHI*d;h=this.___get_difference_at_angle(a,b,e);f=this.___get_difference_at_angle(a,b,g);if(Infinity!==h&&Infinity!==f){for(;Math.abs(d-c)>k;)h<f?(d=g,g=e,f=h,e=this.MATH.PHI*c+(1-this.MATH.PHI)*d,
h=this.___get_difference_at_angle(a,b,e)):(c=e,e=g,h=f,g=this.MATH.PHI*d+(1-this.MATH.PHI)*c,f=this.___get_difference_at_angle(a,b,g));return Math.min(h,f)}return Infinity};f.prototype.___get_centroid=function(a){var b,c,d,e;b=new k;d=0;for(e=a.length;d<e;d++)c=a[d],b.add(c);b.div(a.length);return b};f.prototype.___get_length=function(a){var b,c,d,e,g;b=0;d=null;e=0;for(g=a.length;e<g;e++)c=a[e],null!==d&&(b+=c.dist(d)),d=c;return b};f.prototype.___get_difference_at_angle=function(a,b,c){var d;d=
this.___get_centroid(a);a=this.___rotate(a,c,d);return this.___get_difference(a,b)};f.prototype.___get_difference=function(a,b){var c,d,e,g,f;d=g=c=0;for(f=a.length;g<f;d=++g)e=a[d],c+=e.dist(b[d]);return c/a.length};f.prototype.___translate=function(a,b){var c,d,e;d=0;for(e=a.length;d<e;d++)c=a[d],c.add(b);return a};f.prototype.___scale=function(a,b){var c,d,e;d=0;for(e=a.length;d<e;d++)c=a[d],c.mult(b);return a};f.prototype.___rotate=function(a,b,c){var d,e,f,h,l,m;f=Math.sin(b);b=Math.cos(b);d=
l=0;for(m=a.length;l<m;d=++l)e=a[d],h=(e.x-c.x)*b-(e.y-c.y)*f+c.x,e=(e.x-c.x)*f+(e.y-c.y)*b+c.y,a[d]=new k(h,e);return a};f.prototype.___radians=function(a){return a*Math.PI/180};return f}()}).call(this);
